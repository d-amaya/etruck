<div class="trip-create-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Create New Trip</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="tripForm" (ngSubmit)="onSubmit()">
        <!-- Location Information -->
        <div class="form-section">
          <h3>Location Details</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Pickup Location</mat-label>
              <input matInput formControlName="pickupLocation" placeholder="Enter pickup address">
              <mat-error>{{ getErrorMessage('pickupLocation') }}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Dropoff Location</mat-label>
              <input matInput formControlName="dropoffLocation" placeholder="Enter dropoff address">
              <mat-error>{{ getErrorMessage('dropoffLocation') }}</mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Schedule Information -->
        <div class="form-section">
          <h3>Schedule</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Pickup Date</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="scheduledPickupDatetime" 
                     [min]="minDate" placeholder="Select date">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error>{{ getErrorMessage('scheduledPickupDatetime') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Pickup Time</mat-label>
              <input matInput type="time" formControlName="scheduledPickupTime" placeholder="HH:MM">
              <mat-error>{{ getErrorMessage('scheduledPickupTime') }}</mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Broker Information -->
        <div class="form-section">
          <h3>Broker</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Select Broker</mat-label>
              <mat-select formControlName="brokerId" [disabled]="loadingBrokers">
                <mat-option *ngFor="let broker of brokers" [value]="broker.brokerId">
                  {{ broker.brokerName }}
                </mat-option>
              </mat-select>
              <mat-hint *ngIf="loadingBrokers">Loading brokers...</mat-hint>
              <mat-error>{{ getErrorMessage('brokerId') }}</mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Vehicle and Driver Information -->
        <div class="form-section">
          <h3>Vehicle & Driver</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Lorry ID (License Plate)</mat-label>
              <input matInput formControlName="lorryId" placeholder="e.g., ABC-1234">
              <mat-error>{{ getErrorMessage('lorryId') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Distance (miles)</mat-label>
              <input matInput type="number" formControlName="distance" placeholder="Optional">
              <mat-error>{{ getErrorMessage('distance') }}</mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Driver ID</mat-label>
              <input matInput formControlName="driverId" placeholder="Driver identifier">
              <mat-error>{{ getErrorMessage('driverId') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Driver Name</mat-label>
              <input matInput formControlName="driverName" placeholder="Full name">
              <mat-error>{{ getErrorMessage('driverName') }}</mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Payment Information -->
        <div class="form-section">
          <h3>Payment Details</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="third-width">
              <mat-label>Broker Payment ($)</mat-label>
              <input matInput type="number" step="0.01" formControlName="brokerPayment" 
                     placeholder="0.00">
              <mat-hint>Amount broker will pay</mat-hint>
              <mat-error>{{ getErrorMessage('brokerPayment') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="third-width">
              <mat-label>Lorry Owner Payment ($)</mat-label>
              <input matInput type="number" step="0.01" formControlName="lorryOwnerPayment" 
                     placeholder="0.00">
              <mat-hint>Amount to pay lorry owner</mat-hint>
              <mat-error>{{ getErrorMessage('lorryOwnerPayment') }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="third-width">
              <mat-label>Driver Payment ($)</mat-label>
              <input matInput type="number" step="0.01" formControlName="driverPayment" 
                     placeholder="0.00">
              <mat-hint>Amount to pay driver</mat-hint>
              <mat-error>{{ getErrorMessage('driverPayment') }}</mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button mat-raised-button type="button" (click)="onCancel()" [disabled]="loading">
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="loading || loadingBrokers">
            <mat-spinner *ngIf="loading" diameter="20" class="button-spinner"></mat-spinner>
            <span *ngIf="!loading">Create Trip</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
