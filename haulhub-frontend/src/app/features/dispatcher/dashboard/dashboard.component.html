<div class="dashboard-container">
  <!-- Error State -->
  <app-error-state 
    *ngIf="errorState.hasError && !loadingState.isLoading"
    [title]="'Dashboard Error'"
    [message]="errorState.errorMessage"
    [isRetrying]="loadingState.isLoading"
    (retry)="onRetry()">
  </app-error-state>

  <!-- Dashboard Content -->
  <div *ngIf="!errorState.hasError" class="dashboard-content">
    <!-- Unified Filter Card -->
    <app-unified-filter-card></app-unified-filter-card>

    <!-- Loading Overlay for Filter Updates -->
    <div class="content-wrapper" [style.position]="loadingState.isFilterUpdate ? 'relative' : 'static'">
      <app-loading-overlay 
        [isVisible]="loadingState.isFilterUpdate"
        [message]="loadingState.loadingMessage">
      </app-loading-overlay>

      <!-- Initial Load: Show Skeleton Loaders -->
      <div *ngIf="loadingState.isInitialLoad" class="skeleton-content">
        <app-trip-table-skeleton></app-trip-table-skeleton>
      </div>

      <!-- Loaded Content - View Mode Based -->
      <div *ngIf="!loadingState.isInitialLoad" class="loaded-content">
        <!-- Table View -->
        <div *ngIf="currentViewMode === 'table'" class="table-view">
          <!-- Trip Table -->
          <div class="table-section">
            <app-trip-table></app-trip-table>
          </div>
        </div>

        <!-- Analytics View -->
        <div *ngIf="currentViewMode === 'analytics'" class="analytics-view">
          <app-analytics-wrapper></app-analytics-wrapper>
        </div>

        <!-- Payments View -->
        <div *ngIf="currentViewMode === 'payments'" class="payments-view">
          <app-payments-wrapper></app-payments-wrapper>
        </div>
      </div>
    </div>
  </div>
</div>
