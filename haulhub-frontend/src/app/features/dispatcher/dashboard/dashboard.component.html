<div class="dashboard-container">
  <!-- Error State -->
  <app-error-state 
    *ngIf="errorState.hasError && !loadingState.isLoading"
    [title]="'Dashboard Error'"
    [message]="errorState.errorMessage"
    [isRetrying]="loadingState.isLoading"
    (retry)="onRetry()">
  </app-error-state>

  <!-- Dashboard Content -->
  <div *ngIf="!errorState.hasError" class="dashboard-content">
    <!-- Filters are now integrated in the compact top row -->

    <!-- Loading Overlay for Filter Updates -->
    <div class="content-wrapper" [style.position]="loadingState.isFilterUpdate ? 'relative' : 'static'">
      <app-loading-overlay 
        [isVisible]="loadingState.isFilterUpdate"
        [message]="loadingState.loadingMessage">
      </app-loading-overlay>

      <!-- Initial Load: Show Skeleton Loaders -->
      <div *ngIf="loadingState.isInitialLoad" class="skeleton-content">
        <app-trip-summary-skeleton></app-trip-summary-skeleton>
        <app-payment-summary-skeleton></app-payment-summary-skeleton>
        <app-dashboard-charts-skeleton></app-dashboard-charts-skeleton>
        <app-trip-table-skeleton></app-trip-table-skeleton>
      </div>

      <!-- Loaded Content -->
      <div *ngIf="!loadingState.isInitialLoad" class="loaded-content">
        <!-- Compact Top Row: Filters + Charts + Payment Summary -->
        <div class="compact-top-row">
          <!-- Compact Filters -->
          <div class="compact-filters-section">
            <app-filter-bar></app-filter-bar>
          </div>
          
          <!-- Charts with Type Selector -->
          <div class="compact-charts-section">
            <app-dashboard-charts></app-dashboard-charts>
          </div>
          
          <!-- Compact Payment Summary -->
          <div class="compact-payment-section">
            <app-payment-summary></app-payment-summary>
          </div>
        </div>

        <!-- Trip Table -->
        <div class="table-section">
          <app-trip-table></app-trip-table>
        </div>
      </div>
    </div>
  </div>
</div>
