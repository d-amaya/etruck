<div class="trip-detail-container">
  <div class="loading-container" *ngIf="loading">
    <mat-spinner></mat-spinner>
    <p>Loading trip details...</p>
  </div>

  <div class="error-container" *ngIf="error && !loading">
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        <h2>Error Loading Trip</h2>
        <p>{{ error }}</p>
        <button mat-raised-button color="primary" (click)="onBackToTrips()">
          <mat-icon>arrow_back</mat-icon>
          Back to Trips
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="trip-content" *ngIf="trip && !loading">
    <mat-card class="header-card">
      <mat-card-header>
        <mat-card-title>
          <h1>Trip Details</h1>
        </mat-card-title>
        <div class="header-actions">
          <button mat-button (click)="onBackToTrips()">
            <mat-icon>arrow_back</mat-icon>
            Back to Trips
          </button>
          <button mat-raised-button color="accent" (click)="onUpdateStatus()">
            <mat-icon>update</mat-icon>
            Update Status
          </button>
          <button mat-raised-button color="primary" (click)="onEditTrip()">
            <mat-icon>edit</mat-icon>
            Edit Trip
          </button>
        </div>
      </mat-card-header>
    </mat-card>

    <div class="details-grid">
      <!-- Status Card -->
      <mat-card class="detail-card status-card">
        <mat-card-header>
          <mat-card-title>Status</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-chip-set>
            <mat-chip [ngClass]="getStatusClass(trip.status)">
              {{ getStatusLabel(trip.status) }}
            </mat-chip>
          </mat-chip-set>
        </mat-card-content>
      </mat-card>

      <!-- Trip Information Card -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>Trip Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">Trip ID:</span>
            <span class="detail-value">{{ trip.tripId }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Scheduled Pickup:</span>
            <span class="detail-value">{{ formatDate(trip.scheduledPickupDatetime) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Pickup Location:</span>
            <span class="detail-value">{{ trip.pickupLocation }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Dropoff Location:</span>
            <span class="detail-value">{{ trip.dropoffLocation }}</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Broker Information Card -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>Broker Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">Broker Name:</span>
            <span class="detail-value">{{ trip.brokerName }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Broker ID:</span>
            <span class="detail-value">{{ trip.brokerId }}</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Vehicle & Driver Card -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>Vehicle & Driver</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">Lorry ID:</span>
            <span class="detail-value">{{ trip.lorryId }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Driver Name:</span>
            <span class="detail-value">{{ trip.driverName }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Driver ID:</span>
            <span class="detail-value">{{ trip.driverId }}</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Payment Information Card -->
      <mat-card class="detail-card payment-card">
        <mat-card-header>
          <mat-card-title>Payment Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">Broker Payment:</span>
            <span class="detail-value payment-positive">{{ formatCurrency(trip.brokerPayment) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Lorry Owner Payment:</span>
            <span class="detail-value payment-negative">{{ formatCurrency(trip.lorryOwnerPayment) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Driver Payment:</span>
            <span class="detail-value payment-negative">{{ formatCurrency(trip.driverPayment) }}</span>
          </div>
          <mat-divider></mat-divider>
          <div class="detail-row profit-row">
            <span class="detail-label">Profit:</span>
            <span class="detail-value" [ngClass]="calculateProfit() >= 0 ? 'payment-positive' : 'payment-negative'">
              {{ formatCurrency(calculateProfit()) }}
            </span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Timestamps Card -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>Timestamps</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="detail-row">
            <span class="detail-label">Created At:</span>
            <span class="detail-value">{{ formatDate(trip.createdAt) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Last Updated:</span>
            <span class="detail-value">{{ formatDate(trip.updatedAt) }}</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
