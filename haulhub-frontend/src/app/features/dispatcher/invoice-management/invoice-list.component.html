<div class="invoice-list-container">
  <div class="page-header">
    <h1>Invoice Management</h1>
    <button class="btn btn-primary" (click)="createInvoice()">
      <i class="icon-plus"></i> Create Invoice
    </button>
  </div>

  <!-- Summary Cards -->
  <div class="summary-cards">
    <div class="summary-card">
      <div class="card-label">Total Outstanding</div>
      <div class="card-value">{{ formatCurrency(totalOutstanding) }}</div>
    </div>
    <div class="summary-card overdue">
      <div class="card-label">Overdue</div>
      <div class="card-value">{{ formatCurrency(overdueAmount) }}</div>
    </div>
    <div class="summary-card current">
      <div class="card-label">Current</div>
      <div class="card-value">{{ formatCurrency(currentAmount) }}</div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="status-filter">Status</label>
      <select 
        id="status-filter" 
        [(ngModel)]="statusFilter" 
        (change)="onFilterChange()"
        class="form-select">
        <option value="all">All Statuses</option>
        <option value="unpaid">Unpaid</option>
        <option value="partial">Partially Paid</option>
        <option value="overdue">Overdue</option>
        <option value="paid">Paid</option>
      </select>
    </div>

    <div class="filter-group search-group">
      <label for="search">Search</label>
      <input 
        id="search"
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onFilterChange()"
        placeholder="Search by invoice #, trip ID, or broker..."
        class="form-input">
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading invoices...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <p class="error-message">{{ error }}</p>
    <button class="btn btn-secondary" (click)="loadInvoices()">Retry</button>
  </div>

  <!-- Invoice Table -->
  <div *ngIf="!loading && !error" class="invoice-table-container">
    <table class="invoice-table">
      <thead>
        <tr>
          <th (click)="onSort('dueDate')" class="sortable">
            Invoice #
            <span class="sort-indicator" *ngIf="sortBy === 'dueDate'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th>Trip ID</th>
          <th>Broker</th>
          <th (click)="onSort('amount')" class="sortable">
            Amount
            <span class="sort-indicator" *ngIf="sortBy === 'amount'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="onSort('dueDate')" class="sortable">
            Due Date
            <span class="sort-indicator" *ngIf="sortBy === 'dueDate'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="onSort('status')" class="sortable">
            Status
            <span class="sort-indicator" *ngIf="sortBy === 'status'">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let invoice of filteredInvoices" (click)="viewInvoice(invoice)" class="invoice-row">
          <td class="invoice-number">{{ invoice.invoiceNumber }}</td>
          <td>{{ invoice.tripId }}</td>
          <td>{{ invoice.brokerName }}</td>
          <td class="amount">{{ formatCurrency(invoice.amount) }}</td>
          <td>
            {{ formatDate(invoice.dueDate) }}
            <span *ngIf="invoice.daysOverdue && invoice.daysOverdue > 0" class="overdue-badge">
              {{ invoice.daysOverdue }} days overdue
            </span>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(invoice.status)">
              {{ invoice.status }}
            </span>
          </td>
          <td class="actions">
            <button class="btn-icon" (click)="viewInvoice(invoice); $event.stopPropagation()" title="View Details">
              <i class="icon-eye"></i>
            </button>
          </td>
        </tr>
        <tr *ngIf="filteredInvoices.length === 0">
          <td colspan="7" class="no-data">
            No invoices found matching your criteria
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
